blueprint:
  name: Frigate ALPR Notification (v1.0.1)
  description: Send a notification when a specific license plate is detected.
  domain: automation
  input:
    mqtt_topic:
      name: MQTT Topic
      description: The MQTT topic to listen to for ALPR events.
      default: frigate/frigate_alpr
    watch_license_plate:
      name: Alert License Plate
      description: The license plate number to watch for.
      selector:
        text:
    notify_service:
      name: Mobile Notification
      description: The mobile device to notify.
      selector:
        device:
          integration: mobile_app
    alert_reason:
      name: Alert Reason
      description: Reason for the alert.
      selector:
        text:
    message_template:
      name: Message
      description: The message to send when the watched license plate is detected. Create your own message using {{ plate_number }} and {{ alert_reason }}
      default: "Alert license plate detected: {{ plate_number }} Reason: {{ alert_reason }}"
      selector:
        text:

trigger:
  platform: mqtt
  topic: !input mqtt_topic

action:
  - variables:
      payload: "{{ trigger.payload_json }}"
      plate_number: "{{ payload.plate_number }}"
      watch_license_plate: !input watch_license_plate
      alert_reason: !input alert_reason
  - condition: template
    value_template: "{{ plate_number|string == watch_license_plate|string }}"
  - device_id: !input notify_service
    domain: mobile_app
    type: notify
    title: "License Plate Detected"
    message: !input message_template
    data:
      tag: "ALPR_NOTIFICATION"

mode: single
